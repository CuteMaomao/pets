<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        .mark{
            position:absolute;
            height:100px;
            width:100px;
            left:330px;
            top:180px;
            border:1px solid #000;
            cursor:move;
        }
    </style>
</head>
<body>
<input type="file" id="file"><button id="btn">上传</button>
<canvas id="c1"></canvas>
<div class="mark" id="mark"></div>
<canvas id="c3"></canvas>
<script src="../util/jquery-3.4.1.min.js"></script>
<script>
    var canvas1 = document.getElementById("c1")
    var oMark = document.getElementById("mark")
    var canvas3= document.getElementById("c3")
    var btn= document.getElementById("btn")
    canvas1.height = 300;
    canvas1.width=300;
    canvas3.height=100;
    canvas3.width=100;
    var gd1 = canvas1.getContext("2d");
    var srcX = oMark.offsetLeft-canvas1.getBoundingClientRect().left;
    var srcY = oMark.offsetTop-canvas1.getBoundingClientRect().top;
    var sWidth = oMark.offsetWidth;
    var sHeight = oMark.offsetHeight;
    //上传图片
    var oF=document.getElementById('file');
    var src;
    var oImg = new Image();
    btn.onclick=function () {
        //创建文件阅读器
        var oFReader=new FileReader();
        //读取文件
        oFReader.readAsDataURL(oF.files[0])
        //等待文件读取完毕的时候
        oFReader.onloadend=function () {
            src = event.target.result;
            oImg.src = src;
        }
    }
    //拖拽
    var disX=0;
    var disY=0;
    function fnMove() {
        oMark.style.left=event.clientX-disX+'px';
        oMark.style.top=event.clientY-disY+'px';
    }

    function fnUp() {
        $(document).off('mousemove',fnMove);
        $(document).off('mouseup',fnUp);
    }
    oMark.onmousedown=function () {
        disX=event.offsetX;
        disY=event.offsetY;
        $(document).on('mousemove',fnMove);
        $(document).on('mouseup',fnUp);
    }
    var canvas2 = document.createElement("canvas")
    var gd2=canvas2.getContext("2d")
    oImg.onload = function(){
        gd1.drawImage(oImg,0,0,canvas1.width,canvas1.height);
        var dataImg = gd1.getImageData(srcX,srcY,sWidth,sHeight)
        canvas2.width = sWidth;
        canvas2.height = sHeight;
        gd2.putImageData(dataImg,0,0,0,0,canvas2.width,canvas2.height)
        var img2 = canvas2.toDataURL("image/*");
        var gd3=canvas3.getContext("2d")
        var img3 = new Image();
        img3.src = img2;
        img3.onload  = function(){
            gd3.drawImage(img3,0,0,canvas3.width,canvas3.height)
        }

    }
</script>
</body>
</html>